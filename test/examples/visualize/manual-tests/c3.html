<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Keen IO Visualization JS Test</title>
</head>
<body>
  <script>
  // -------------
  // LATENCY TEST
  // -------------
  (function(n,c){
    if (c[n] === void 0) {

      c['_'+n] = {};
      c[n] = function(e) {
        c['_'+n]['clients'] = c['_'+n]['clients'] || {};
        c['_'+n]['clients'][e.projectId] = this;
        this._config = e;
      };

      // Keen.ready(function(){});
      c[n]['ready'] = function(callback){
        c['_'+n]['ready'] = c['_'+n]['ready'] || [];
        c['_'+n]['ready'].push(callback);
      };

      var methods = ['addEvent', 'setGlobalProperties', 'trackExternalLink', 'on'];
      for (var i = 0; i < methods.length; i++){
        var method = methods[i];
        var action = function(method){
          return function() {
            this['_'+method] = this['_'+method] || [];
            this['_'+method].push(arguments);
            return this;
          }
        };
        c[n].prototype[method] = action(method);
      }

      var s = document.createElement("script");
      s.type = "text/javascript", s.async = !0, s.src = "../../../dist/keen.js";

      var t = document.getElementsByTagName("script")[0];
      setTimeout(function(){
        t.parentNode.insertBefore(s,t);
      }, 2000);
    }
  })('Keen', this);
  </script>
  <script>

    var keen = new Keen({
      projectId: "52f2ae5905cd661a7800000a",
      readKey: "4e4d72e5bf8b69686ed87a5a9671bba7ad829fbd10a1c281ee51b6e9c1ce9548e941e1f336f9de9281a5acc66ca8fdabc9b3c806e390eca01665f6a308a9b03d8b332b3fbd9f3cdfc3b3e16b0da6d84851e53fe20fbbce300801b8a401a6395b9f4ab9c89bff566e9678a74ca6624f9b",
      requestType: "jsonp"
    });

    var chartTypes = ['spline', 'pie', 'donut', 'area-spline', 'bar', 'scatter'];
    var labelMapping = {
      null: 'N/A',
      "file://localhost/Users/Larimer/Downloads/gist3a84fb3288737047e173-05ee2560c1be278096416081960b98ff0104ea4d/index.html": "Home",
      "file://localhost/Users/Larimer/dev/keen/sandbox/video.js%20plugin/index.html": "Video page"
    };

    var optionOne = {
      isStacked: true,
      axis: {
        x: {
          type: 'timeseries',
          tick: {
            format: '%Y-%m-%d'
          }
        }
      }
    };

    var optionTwo = {
      isStacked: true
    };

    Keen.ready(function(){
      multiline = new Keen.Query("count", {
        event_collection: "pageview",
        group_by: "page",
        timeframe: "this_12_months",
        interval: "monthly"
      });

      /**
       * MASS TEST
       */
      // keen.run(multiline, function(res){
      //   var newData = res;
      //   for (var i = 0; i < res.result.length; i++) {
      //     for (var j = 0; j < res.result[i].value.length; j++) {
      //       newData.result[i].value[j].result = Math.floor(Math.random() * (500 - 100 + 1)) + 100;
      //     }
      //   }
      //   this.data = newData;

      //   for(i = 0; i < chartTypes.length; i++) {
      //     var div = document.createElement('div');
      //     document.querySelector('body').appendChild(div);
      //     if(chartTypes[i] === 'pie' || chartTypes[i] === 'donut') {
      //       chartOptions = optionTwo;
      //     } else {
      //       chartOptions = optionOne;
      //     }

      //     new Keen.Visualization(this, div, {
      //       library: "c3",
      //       chartType: chartTypes[i],
      //       chartOptions: chartOptions,
      //       labelMapping: labelMapping
      //     });

      //   }

      // });

      /**
       * SINGLE TESTS
       */
      keen.run(multiline, function(res) {
        var newData = res;
        for (var i = 0; i < res.result.length; i++) {
          for (var j = 0; j < res.result[i].value.length; j++) {
            newData.result[i].value[j].result = Math.floor(Math.random() * (500 - 100 + 1)) + 100;
          }
        }
        this.data = newData;
        var div = document.createElement('div');
        document.querySelector('body').appendChild(div);

        new Keen.Visualization(this, div, {
          library: "c3",
          chartOptions: {
            isStacked: true,
            axis: {
              x: {
                type: 'timeseries',
                tick: {
                  format: '%Y-%m-%d'
                }
              }
            }
          },
          labelMapping: labelMapping
        });
      });

    });

  </script>
</body>
</html>
